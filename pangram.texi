\input texinfo    @c -*- texinfo -*-
@c %**start of header
@setfilename pangram.info
@settitle pangram: AI content detection via Pangram API
@documentencoding UTF-8
@documentlanguage en
@c %**end of header

@dircategory Emacs misc features
@direntry
* Pangram: (pangram).   AI content detection via Pangram API.
@end direntry

@finalout
@titlepage
@title pangram: AI content detection via Pangram API
@author Pablo Stafforini (@email{pablo@@stafforini.com})
@end titlepage

@contents

@ifnottex
@node Top
@top pangram: AI content detection via Pangram API

This manual describes the features and customization options for the Emacs Lisp file @samp{pangram.el}.

@end ifnottex

@menu
* Overview::
* Installation::
* User options::
* Commands::
* Troubleshooting::
* License::
* Indices::

@detailmenu
--- The Detailed Node Listing ---

Overview

* Segment classification::

Installation

* Prerequisites::
* With elpaca::
* With straight.el: With straightel. 
* With use-package and package-vc::
* With quelpa::
* Manual installation::

User options

* API endpoint::
* Faces::

Commands

* Detecting AI-generated content::
* Clearing overlays::

Troubleshooting

* ``Environment variable PERSONAL@math{_EMAIL} is not set''::
* ``Pangram API key not found in pass store''::
* ``Pangram API returned HTTP NNN''::
* No overlays appear after detection::

Indices

* Function index::
* Variable index::

@end detailmenu
@end menu

@node Overview
@chapter Overview

@samp{pangram.el} provides an Emacs interface to the @uref{https://pangram.readthedocs.io/en/latest/api/rest.html, Pangram Labs API (v3)}
for detecting AI-generated content in text.  Given a buffer or an
active region, the package sends the text to Pangram's inference
endpoint and visually highlights segments that the API classifies as
AI-generated or AI-assisted, using distinct overlay faces.  Human-written
segments are left unmarked.

The core workflow is straightforward: invoke @samp{M-x pangram-detect} to
analyze text, then hover over highlighted segments to see classification
details (label, confidence score, and AI assistance score) in the
echo area.  When you are done reviewing, invoke @samp{M-x pangram-clear} to
remove the overlays.

The package requires an active Pangram Labs API key, which it retrieves
from the @samp{pass} password store via @samp{auth-source-pass.el}.  It depends
only on built-in Emacs libraries (@code{json}, @code{url}, @code{auth-source-pass},
@code{seq}) and requires Emacs 29.1 or later.

The development repository is on @uref{https://github.com/benthamite/pangram, GitHub}.

@menu
* Segment classification::
@end menu

@node Segment classification
@section Segment classification

The Pangram API divides the submitted text into @emph{windows} (contiguous
segments) and assigns each a classification label.  @samp{pangram.el}
recognizes three categories:

@itemize
@item
@strong{AI-generated} -- text that the API identifies as produced entirely
by an AI system.  Highlighted with the @code{pangram-ai} face.
@item
@strong{AI-assisted} -- text that appears to have been written with AI
assistance but retains significant human involvement.  Highlighted
with the @code{pangram-ai-assisted} face.
@item
@strong{Human} -- text classified as entirely human-written.  Not highlighted.
@end itemize

After analysis, the echo area displays a summary line showing the
overall verdict (headline) and the percentage breakdown across all
three categories.

@node Installation
@chapter Installation

@menu
* Prerequisites::
* With elpaca::
* With straight.el: With straightel. 
* With use-package and package-vc::
* With quelpa::
* Manual installation::
@end menu

@node Prerequisites
@section Prerequisites

Before using @samp{pangram.el}, you need:

@enumerate
@item
A Pangram Labs API key.  Sign up at @uref{https://pangram.com, pangram.com} to obtain one.
@item
The @samp{pass} password manager with the @samp{auth-source-pass} integration
configured in Emacs.
@item
The environment variable @code{PERSONAL_EMAIL} set to the email address
associated with your Pangram account.
@end enumerate

Store your API key in the pass store under the path
@samp{chrome/pangram.com/YOUR_EMAIL}, with the key stored in a field named
@samp{key}.  For example:

@example
pass insert chrome/pangram.com/user@@example.com
@end example

Then edit the entry to include a line like @samp{key: YOUR_API_KEY}.

@node With elpaca
@section With elpaca

@lisp
(use-package pangram
  :elpaca (:host github :repo "benthamite/pangram"))
@end lisp

@node With straightel
@section With straight.el

@lisp
(use-package pangram
  :straight (:host github :repo "benthamite/pangram"))
@end lisp

@node With use-package and package-vc
@section With use-package and package-vc

On Emacs 29 or later, you can use the built-in @code{package-vc-install}:

@lisp
(use-package pangram
  :vc (:url "https://github.com/benthamite/pangram" :branch "main"))
@end lisp

@node With quelpa
@section With quelpa

@lisp
(use-package pangram
  :quelpa (pangram :fetcher github :repo "benthamite/pangram"))
@end lisp

@node Manual installation
@section Manual installation

Clone the repository and add it to your @code{load-path}:

@lisp
(add-to-list 'load-path "/path/to/pangram")
(require 'pangram)
@end lisp

@node User options
@chapter User options

@menu
* API endpoint::
* Faces::
@end menu

@node API endpoint
@section API endpoint

@vindex pangram-api-url
The user option @code{pangram-api-url} specifies the URL of the Pangram
inference API endpoint.  Its default value is
@samp{https://text.api.pangram.com/v3}, which points to version 3 of the
Pangram REST API@.

You would change this option if Pangram releases a newer API version
or if you need to point to a different endpoint (for example, a
self-hosted or staging instance).  The value must be a string
containing a fully qualified URL@.

@node Faces
@section Faces

@samp{pangram.el} defines two faces for highlighting detected segments.
Both adapt to the current background mode (light or dark), so they
remain legible regardless of your theme.

@vindex pangram-ai
The face @code{pangram-ai} is used for text segments classified as
AI-generated.  It defaults to a red-tinted background: @samp{#ffcccc} on
light backgrounds and @samp{#5c2020} on dark backgrounds.  Customize this
face if you want a different visual treatment for AI-generated text,
or if it clashes with your color theme.

@vindex pangram-ai-assisted
The face @code{pangram-ai-assisted} is used for text segments classified as
AI-assisted.  It defaults to an amber-tinted background: @samp{#fff0cc} on
light backgrounds and @samp{#5c4020} on dark backgrounds.  The warmer tone
distinguishes it from the sharper red of @code{pangram-ai}, reflecting the
lower severity of the classification.

You can customize either face with @samp{M-x customize-face} or by setting
their attributes in your init file:

@lisp
(set-face-attribute 'pangram-ai nil :background "#ff9999" :foreground "#000000")
@end lisp

@node Commands
@chapter Commands

@menu
* Detecting AI-generated content::
* Clearing overlays::
@end menu

@node Detecting AI-generated content
@section Detecting AI-generated content

@findex pangram-detect
The command @code{pangram-detect} sends text to the Pangram API for
AI content analysis and highlights the results in the current buffer.

If a region is active, only the selected text is analyzed; otherwise,
the entire buffer contents are sent.  The command operates
asynchronously: it sends the request and returns immediately, applying
overlays to the buffer when the response arrives.  A progress message
(``Sending text to Pangram API@dots{}'') appears in the echo area while the
request is in flight.

Once the API responds, @samp{pangram.el} creates overlays on each text
segment that the API classified as AI-generated or AI-assisted, using
the @code{pangram-ai} and @code{pangram-ai-assisted} faces respectively
(@ref{Faces}).  Human-classified segments receive no overlay.
Hovering over any highlighted segment displays a tooltip with the
segment's label, AI assistance score (a float between 0 and 1), and
confidence level.

The echo area then shows a summary line in the form:

@example
Pangram: HEADLINE -- AI: X%, AI-assisted: Y%, Human: Z%
@end example

Any previous Pangram overlays in the buffer are cleared before new
ones are applied, so calling @code{pangram-detect} multiple times does not
accumulate stale highlights.

If the buffer or region contains only whitespace, the command signals
an error rather than making a pointless API call.

@node Clearing overlays
@section Clearing overlays

@findex pangram-clear
The command @code{pangram-clear} removes all Pangram overlays from the
current buffer.  This is useful when you have finished reviewing the
analysis results and want to restore the buffer to its normal
appearance, or when you want a clean slate before running
@code{pangram-detect} again on a different region.

The command removes overlays across the entire buffer, regardless of
whether the original analysis was performed on the full buffer or on a
region.

@node Troubleshooting
@chapter Troubleshooting

@menu
* ``Environment variable PERSONAL@math{_EMAIL} is not set''::
* ``Pangram API key not found in pass store''::
* ``Pangram API returned HTTP NNN''::
* No overlays appear after detection::
@end menu

@node ``Environment variable PERSONAL@math{_EMAIL} is not set''
@section ``Environment variable PERSONAL@math{_EMAIL} is not set''

This error means the @code{PERSONAL_EMAIL} environment variable is not
available in your Emacs session.  Set it in your shell profile (e.g.,
@samp{.bashrc}, @samp{.zshrc}) or in your Emacs init file:

@lisp
(setenv "PERSONAL_EMAIL" "user@@example.com")
@end lisp

If you launch Emacs from a desktop environment that does not inherit
shell variables, you may need the @samp{exec-path-from-shell} package or
an equivalent mechanism to propagate environment variables.

@node ``Pangram API key not found in pass store''
@section ``Pangram API key not found in pass store''

This error indicates that @samp{auth-source-pass} could not find an entry
at the expected path.  Verify that:

@enumerate
@item
The @samp{pass} store contains an entry at
@samp{chrome/pangram.com/YOUR_EMAIL} (where @code{YOUR_EMAIL} matches the
value of @code{PERSONAL_EMAIL}).
@item
The entry contains a field named @samp{key} with your Pangram API key
as its value.
@item
@samp{auth-source-pass-enable} has been called in your init file, or
@samp{auth-source-pass} is otherwise properly configured.
@end enumerate

@node ``Pangram API returned HTTP NNN''
@section ``Pangram API returned HTTP NNN''

A non-2xx HTTP status code was returned by the API@.  Common causes:

@itemize
@item
@strong{401}: invalid or expired API key.  Verify your key in the pass
store.
@item
@strong{429}: rate limit exceeded.  Wait before retrying.
@item
@strong{500} or @strong{502}: server-side issue at Pangram.  Try again later.
@end itemize

@node No overlays appear after detection
@section No overlays appear after detection

If the echo area shows a summary but no text is highlighted, the API
likely classified all segments as human-written.  This is the expected
behavior -- @samp{pangram.el} only highlights non-human segments.

@node License
@chapter License

@samp{pangram.el} is free software, distributed under the terms of the GNU
General Public License, version 3 or later.  See the @samp{COPYING} file
or @uref{https://www.gnu.org/licenses/gpl-3.0.html, the GPL website} for details.

@node Indices
@chapter Indices

@menu
* Function index::
* Variable index::
@end menu

@node Function index
@section Function index

@printindex fn

@node Variable index
@section Variable index

@printindex vr

@bye
